<div
  #container
  [ngClass]="containerClass()"
  [class.magary-contextmenu-visible]="visible()"
  [style.left.px]="x()"
  [style.top.px]="y()"
  [style]="style()"
>
  <ul class="magary-contextmenu-root-list">
    <ng-template ngFor let-item [ngForOf]="processedModel()">
      <li
        class="magary-menuitem"
        [ngClass]="{
          'magary-menuitem-active': item.expanded,
          'magary-menu-separator': item.separator,
          'magary-disabled': item.disabled,
        }"
        (mouseenter)="onItemMouseEnter(item, model())"
      >
        @if (item.separator) {
        } @else {
          <div class="magary-menuitem-content">
            <a
              class="magary-menuitem-link"
              [href]="item.url || '#'"
              [attr.target]="item.target"
              (click)="onItemClick($event, item)"
            >
              @if (item.icon) {
                <lucide-icon
                  [name]="item.icon"
                  class="magary-menuitem-icon"
                  [size]="16"
                ></lucide-icon>
              }
              <span class="magary-menuitem-text">{{ item.label }}</span>
              @if (item.items && item.items.length > 0) {
                <lucide-icon
                  name="chevron-right"
                  class="magary-submenu-icon"
                  [size]="14"
                ></lucide-icon>
              }
            </a>
          </div>

          <!-- Recursive Submenu -->
          @if (item.items && item.items.length > 0) {
            <ul class="magary-submenu">
              <ng-container
                *ngTemplateOutlet="
                  submenuTemplate;
                  context: { $implicit: item.items }
                "
              ></ng-container>
            </ul>
          }
        }
      </li>
    </ng-template>
  </ul>
</div>

<!-- Reusable Recursive Template -->
<ng-template #submenuTemplate let-items>
  <ng-template ngFor let-child [ngForOf]="items">
    <li
      class="magary-menuitem"
      [ngClass]="{
        'magary-menuitem-active': child.expanded,
        'magary-menu-separator': child.separator,
        'magary-disabled': child.disabled,
      }"
      (mouseenter)="onItemMouseEnter(child, items)"
    >
      @if (!child.separator) {
        <div class="magary-menuitem-content">
          <a
            class="magary-menuitem-link"
            [href]="child.url || '#'"
            (click)="onItemClick($event, child)"
          >
            @if (child.icon) {
              <lucide-icon
                [name]="child.icon"
                class="magary-menuitem-icon"
                [size]="16"
              ></lucide-icon>
            }
            <span class="magary-menuitem-text">{{ child.label }}</span>
            @if (child.items && child.items.length > 0) {
              <lucide-icon
                name="chevron-right"
                class="magary-submenu-icon"
                [size]="14"
              ></lucide-icon>
            }
          </a>
        </div>
        @if (child.items && child.items.length > 0) {
          <ul class="magary-submenu">
            <ng-container
              *ngTemplateOutlet="
                submenuTemplate;
                context: { $implicit: child.items }
              "
            ></ng-container>
          </ul>
        }
      }
    </li>
  </ng-template>
</ng-template>
