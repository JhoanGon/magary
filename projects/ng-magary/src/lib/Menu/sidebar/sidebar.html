<button
  class="hamburger-button"
  type="button"
  [attr.aria-label]="mobileMenuButtonLabel()"
  [attr.aria-controls]="sidebarId"
  [attr.aria-expanded]="isMobileOpen()"
  (click)="toggleMobileSidebar()"
>
  <lucide-icon name="menu"></lucide-icon>
</button>
@if (isMobileOpen()) {
  <div class="sidebar-backdrop" (click)="closeMobileSidebar()"></div>
}
<aside
  #sidebarElement
  [id]="sidebarId"
  class="sidebar"
  [class.open]="isMobileOpen()"
  [class.collapsed]="isCollapsed()"
  role="complementary"
  [attr.aria-label]="navigationLabel()"
  tabindex="-1"
  (keydown)="onSidebarKeydown($event)"
>
  <div class="sidebar-header" [class.collapsed-header]="isCollapsed()">
    @if (isCollapsed()) {
      @if (showToggle() && collapsible()) {
        <button
          class="header-toggle collapsed"
          type="button"
          aria-label="Expandir sidebar"
          (click)="toggleCollapse()"
        >
          <lucide-icon name="menu"></lucide-icon>
        </button>
      } @else {
        @if (showLogo()) {
          <img
            [ngSrc]="logoSrc()"
            alt="Logo"
            class="logo collapsed-logo"
            routerLink="/"
            style="cursor: pointer"
            [width]="logoWidth()"
            [height]="logoHeight()"
            priority
          />
        }
      }
    } @else {
      <div class="header-brand" routerLink="/" style="cursor: pointer">
        @if (showLogo()) {
          <img
            [ngSrc]="logoSrc()"
            alt="Logo"
            class="logo"
            [width]="logoWidth()"
            [height]="logoHeight()"
            priority
          />
        }
        <span
          class="title"
          [ngClass]="appTitleClass()"
          [ngStyle]="appTitleStyle()"
        >
          {{ appTitle() }}
        </span>
      </div>
      @if (showToggle() && collapsible()) {
        <button
          class="header-toggle expanded"
          type="button"
          aria-label="Colapsar sidebar"
          (click)="toggleCollapse()"
        >
          <lucide-icon name="chevron-left"></lucide-icon>
        </button>
      }
    }
    <button
      #closeButton
      class="close-button"
      type="button"
      [attr.aria-label]="closeButtonLabel()"
      (click)="closeMobileSidebar()"
    >
      <lucide-icon name="x"></lucide-icon>
    </button>
  </div>
  <div class="sidebar-content">
    @if (showBrandLogo() && brandLogoPosition() === "top") {
      <div class="brand-logo-container top" [class.collapsed]="isCollapsed()">
        <img
          [ngSrc]="brandLogoSrc()"
          alt="Brand Logo"
          class="brand-logo"
          [width]="brandLogoWidth()"
          [height]="brandLogoHeight()"
          priority
        />
      </div>
    }
    <nav class="menu-container" [attr.aria-label]="navigationLabel()">
      @if (sections().length > 0) {
        @for (section of sections(); track $index) {
          <magary-panelmenu
            [title]="section.title"
            [icon]="section.icon || ''"
            [iconClass]="section.iconClass || ''"
            [items]="section.items"
            [backgroundColor]="section.backgroundColor || menuBackgroundColor()"
            [textColor]="section.textColor || menuTextColor()"
            [hoverColor]="section.hoverColor || menuHoverColor()"
            [borderRadius]="'0.5rem'"
            [shadow]="2"
            [width]="'100%'"
            [collapsed]="isCollapsed()"
            (expandSidebar)="openSidebar()"
          />
        }
      }
      @if (menu().length > 0 && sections().length === 0) {
        <magary-panelmenu
          [title]="menuTitle()"
          [items]="menu()"
          [backgroundColor]="menuBackgroundColor()"
          [textColor]="menuTextColor()"
          [hoverColor]="menuHoverColor()"
          [borderRadius]="'0.5rem'"
          [shadow]="2"
          [width]="'100%'"
          [collapsed]="isCollapsed()"
          (expandSidebar)="openSidebar()"
        />
      }
    </nav>
    @if (showBrandLogo() && brandLogoPosition() === "bottom") {
      <div
        class="brand-logo-container bottom"
        [class.collapsed]="isCollapsed()"
      >
        <img
          [ngSrc]="brandLogoSrc()"
          alt="Brand Logo"
          class="brand-logo"
          [width]="brandLogoWidth()"
          [height]="brandLogoHeight()"
          priority
        />
      </div>
    }
    @if (shouldRenderUserSection()) {
      <div class="user-section">
        @if (shouldShowUserInfo()) {
          <div class="user-info">
            @if (showUserAvatar()) {
              @switch (avatarConfig().type) {
                @case ("image") {
                  <magary-avatar
                    [image]="avatarConfig().image || ''"
                    [size]="avatarConfig().size || 'normal'"
                    [shape]="avatarConfig().shape || 'circle'"
                    [badgeValue]="avatarConfig().badgeValue"
                    [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                    class="user-avatar"
                  />
                }
                @case ("label") {
                  <magary-avatar
                    [label]="avatarConfig().label || getAvatarFallbackLabel()"
                    [size]="avatarConfig().size || 'normal'"
                    [shape]="avatarConfig().shape || 'circle'"
                    [badgeValue]="avatarConfig().badgeValue"
                    [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                    class="user-avatar"
                  />
                }
                @case ("icon") {
                  <magary-avatar
                    [icon]="avatarConfig().icon || 'user'"
                    [size]="avatarConfig().size || 'normal'"
                    [shape]="avatarConfig().shape || 'circle'"
                    [badgeValue]="avatarConfig().badgeValue"
                    [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                    class="user-avatar"
                  />
                }
              }
            }
            @if (shouldShowUserDetails()) {
              <div class="user-details">
                @if (showUserName()) {
                  <div class="username">{{ userName() }}</div>
                }
                @if (showUserEmail()) {
                  <div class="email">{{ userEmail() }}</div>
                }
              </div>
            }
          </div>
        }
        @if (showLogoutButton()) {
          @if (!isCollapsed()) {
            <button
              class="logout-button"
              type="button"
              aria-label="Cerrar sesion"
              (click)="logout()"
            >
              <lucide-icon name="log-out"></lucide-icon>
              Cerrar sesion
            </button>
          } @else {
            <button
              class="logout-button"
              type="button"
              aria-label="Cerrar sesion"
              (click)="logout()"
              title="Cerrar sesion"
            >
              <lucide-icon name="log-out"></lucide-icon>
            </button>
          }
        }
      </div>
    }
  </div>
  @if (showBrandLogo() && brandLogoPosition() === "center") {
    <div class="brand-logo-container center" [class.collapsed]="isCollapsed()">
      <img
        [ngSrc]="brandLogoSrc()"
        alt="Brand Logo"
        class="brand-logo"
        [width]="brandLogoWidth()"
        [height]="brandLogoHeight()"
        priority
      />
    </div>
  }
</aside>
