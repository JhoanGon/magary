<button class="hamburger-button" (click)="toggleMobileSidebar()">
  <i class="fas fa-bars"></i>
</button>
@if (isMobileOpen()) {
  <div class="sidebar-backdrop" (click)="closeMobileSidebar()"></div>
}
<div
  class="sidebar"
  [class.open]="isMobileOpen()"
  [class.collapsed]="isCollapsed()"
>
  <div class="sidebar-header" [class.collapsed-header]="isCollapsed()">
    @if (isCollapsed()) {
      @if (showToggle() && collapsible()) {
        <button class="header-toggle collapsed" (click)="toggleCollapse()">
          <i class="fas fa-bars"></i>
        </button>
      } @else {
        <!-- If toggle hidden but collapsed, show logo icon? -->
        <img [src]="logoSrc()" alt="Logo" class="logo collapsed-logo" />
      }
    } @else {
      <div class="header-brand">
        <img [src]="logoSrc()" alt="Logo" class="logo" />
        <span class="title">{{ appTitle() }}</span>
      </div>
      @if (showToggle() && collapsible()) {
        <button class="header-toggle expanded" (click)="toggleCollapse()">
          <i class="fas fa-chevron-left"></i>
        </button>
      }
    }
    <button class="close-button" (click)="closeMobileSidebar()">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="sidebar-content">
    <div class="menu-container">
      @if (sections().length > 0) {
        @for (section of sections(); track $index) {
          <magary-panelmenu
            [title]="section.title"
            [icon]="section.icon || ''"
            [items]="section.items"
            [backgroundColor]="section.backgroundColor || menuBackgroundColor()"
            [textColor]="section.textColor || menuTextColor()"
            [hoverColor]="section.hoverColor || menuHoverColor()"
            [borderRadius]="'0.5rem'"
            [shadow]="2"
            [width]="'100%'"
            [collapsed]="isCollapsed()"
            (expandSidebar)="openSidebar()"
          />
        }
      }
      @if (menu().length > 0 && sections().length === 0) {
        <magary-panelmenu
          [title]="menuTitle()"
          [items]="menu()"
          [backgroundColor]="menuBackgroundColor()"
          [textColor]="menuTextColor()"
          [hoverColor]="menuHoverColor()"
          [borderRadius]="'0.5rem'"
          [shadow]="2"
          [width]="'100%'"
          [collapsed]="isCollapsed()"
          (expandSidebar)="openSidebar()"
        />
      }
    </div>
    @if (showUserSection()) {
      <div class="user-section">
        <div class="user-info">
          @switch (avatarConfig().type) {
            @case ("image") {
              <magary-avatar
                [image]="avatarConfig().image || ''"
                [size]="avatarConfig().size || 'normal'"
                [shape]="avatarConfig().shape || 'circle'"
                [badgeValue]="avatarConfig().badgeValue"
                [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                class="user-avatar"
              />
            }
            @case ("label") {
              <magary-avatar
                [label]="avatarConfig().label || userName().charAt(0)"
                [size]="avatarConfig().size || 'normal'"
                [shape]="avatarConfig().shape || 'circle'"
                [badgeValue]="avatarConfig().badgeValue"
                [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                class="user-avatar"
              />
            }
            @case ("icon") {
              <magary-avatar
                [icon]="avatarConfig().icon || 'user'"
                [size]="avatarConfig().size || 'normal'"
                [shape]="avatarConfig().shape || 'circle'"
                [badgeValue]="avatarConfig().badgeValue"
                [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                class="user-avatar"
              />
            }
          }
          @if (!isCollapsed()) {
            <div class="user-details">
              <div class="username">{{ userName() }}</div>
              <div class="email">{{ userEmail() }}</div>
            </div>
          }
        </div>
        @if (!isCollapsed()) {
          <button class="logout-button" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i>
            Cerrar sesión
          </button>
        } @else {
          <button
            class="logout-button"
            (click)="logout()"
            title="Cerrar sesión"
          >
            <i class="fas fa-sign-out-alt"></i>
          </button>
        }
      </div>
    }
  </div>
</div>
