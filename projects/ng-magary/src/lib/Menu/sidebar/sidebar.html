<button class="hamburger-button" (click)="toggleMobileSidebar()">
  <lucide-icon name="menu"></lucide-icon>
</button>
@if (isMobileOpen()) {
  <div class="sidebar-backdrop" (click)="closeMobileSidebar()"></div>
}
<div
  class="sidebar"
  [class.open]="isMobileOpen()"
  [class.collapsed]="isCollapsed()"
>
  <div class="sidebar-header" [class.collapsed-header]="isCollapsed()">
    @if (isCollapsed()) {
      @if (showToggle() && collapsible()) {
        <button class="header-toggle collapsed" (click)="toggleCollapse()">
          <lucide-icon name="menu"></lucide-icon>
        </button>
      } @else {
        <!-- If toggle hidden but collapsed, show logo icon? -->
        @if (showLogo()) {
          <img
            [ngSrc]="logoSrc()"
            alt="Logo"
            class="logo collapsed-logo"
            routerLink="/"
            style="cursor: pointer"
            [width]="logoWidth()"
            [height]="logoHeight()"
          />
        }
      }
    } @else {
      <div class="header-brand" routerLink="/" style="cursor: pointer">
        @if (showLogo()) {
          <img
            [ngSrc]="logoSrc()"
            alt="Logo"
            class="logo"
            [width]="logoWidth()"
            [height]="logoHeight()"
            priority
          />
        }
        <span
          class="title"
          [ngClass]="appTitleClass()"
          [ngStyle]="appTitleStyle()"
        >
          {{ appTitle() }}
        </span>
      </div>
      @if (showToggle() && collapsible()) {
        <button class="header-toggle expanded" (click)="toggleCollapse()">
          <lucide-icon name="chevron-left"></lucide-icon>
        </button>
      }
    }
    <button class="close-button" (click)="closeMobileSidebar()">
      <lucide-icon name="x"></lucide-icon>
    </button>
  </div>
  <div class="sidebar-content">
    @if (showBrandLogo() && brandLogoPosition() === "top") {
      <div class="brand-logo-container top" [class.collapsed]="isCollapsed()">
        <img
          [ngSrc]="brandLogoSrc()"
          alt="Brand Logo"
          class="brand-logo"
          [width]="brandLogoWidth()"
          [height]="brandLogoHeight()"
        />
      </div>
    }
    <div class="menu-container">
      @if (sections().length > 0) {
        @for (section of sections(); track $index) {
          <magary-panelmenu
            [title]="section.title"
            [icon]="section.icon || ''"
            [items]="section.items"
            [backgroundColor]="section.backgroundColor || menuBackgroundColor()"
            [textColor]="section.textColor || menuTextColor()"
            [hoverColor]="section.hoverColor || menuHoverColor()"
            [borderRadius]="'0.5rem'"
            [shadow]="2"
            [width]="'100%'"
            [collapsed]="isCollapsed()"
            (expandSidebar)="openSidebar()"
          />
        }
      }
      @if (menu().length > 0 && sections().length === 0) {
        <magary-panelmenu
          [title]="menuTitle()"
          [items]="menu()"
          [backgroundColor]="menuBackgroundColor()"
          [textColor]="menuTextColor()"
          [hoverColor]="menuHoverColor()"
          [borderRadius]="'0.5rem'"
          [shadow]="2"
          [width]="'100%'"
          [collapsed]="isCollapsed()"
          (expandSidebar)="openSidebar()"
        />
      }
    </div>
    @if (showBrandLogo() && brandLogoPosition() === "bottom") {
      <div
        class="brand-logo-container bottom"
        [class.collapsed]="isCollapsed()"
      >
        <img
          [ngSrc]="brandLogoSrc()"
          alt="Brand Logo"
          class="brand-logo"
          [width]="brandLogoWidth()"
          [height]="brandLogoHeight()"
        />
      </div>
    }
    @if (showUserSection()) {
      <div class="user-section">
        <div class="user-info">
          @switch (avatarConfig().type) {
            @case ("image") {
              <magary-avatar
                [image]="avatarConfig().image || ''"
                [size]="avatarConfig().size || 'normal'"
                [shape]="avatarConfig().shape || 'circle'"
                [badgeValue]="avatarConfig().badgeValue"
                [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                class="user-avatar"
              />
            }
            @case ("label") {
              <magary-avatar
                [label]="avatarConfig().label || userName().charAt(0)"
                [size]="avatarConfig().size || 'normal'"
                [shape]="avatarConfig().shape || 'circle'"
                [badgeValue]="avatarConfig().badgeValue"
                [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                class="user-avatar"
              />
            }
            @case ("icon") {
              <magary-avatar
                [icon]="avatarConfig().icon || 'user'"
                [size]="avatarConfig().size || 'normal'"
                [shape]="avatarConfig().shape || 'circle'"
                [badgeValue]="avatarConfig().badgeValue"
                [badgeSeverity]="avatarConfig().badgeSeverity || 'danger'"
                class="user-avatar"
              />
            }
          }
          @if (!isCollapsed()) {
            <div class="user-details">
              <div class="username">{{ userName() }}</div>
              <div class="email">{{ userEmail() }}</div>
            </div>
          }
        </div>
        @if (!isCollapsed()) {
          <button class="logout-button" (click)="logout()">
            <lucide-icon name="log-out"></lucide-icon>
            Cerrar sesión
          </button>
        } @else {
          <button
            class="logout-button"
            (click)="logout()"
            title="Cerrar sesión"
          >
            <lucide-icon name="log-out"></lucide-icon>
          </button>
        }
      </div>
    }
  </div>
  @if (showBrandLogo() && brandLogoPosition() === "center") {
    <div class="brand-logo-container center" [class.collapsed]="isCollapsed()">
      <img
        [ngSrc]="brandLogoSrc()"
        alt="Brand Logo"
        class="brand-logo"
        [width]="brandLogoWidth()"
        [height]="brandLogoHeight()"
      />
    </div>
  }
</div>
