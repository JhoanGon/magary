<div
  class="panel-menu"
  [ngClass]="['shadow-' + shadow()]"
  [class.open]="isOpen()"
  [ngStyle]="panelStyles()"
>
  <div
    class="panel-header"
    [class.header-hovered]="hoveredHeader()"
    (click)="toggle()"
    (mouseenter)="onHeaderHover(true)"
    (mouseleave)="onHeaderHover(false)"
  >
    {{ title() }}
    <span class="arrow" [class.open]="isOpen()">
      <i class="fas fa-chevron-down"></i>
    </span>
  </div>
  <ul class="panel-items" [class.expanded]="isOpen()">
    @for (item of items(); track getItemId(item, $index)) {
      <li class="menu-item">
        @if (hasChildren(item)) {
          <div
            class="category-item"
            [class.item-hovered]="isItemHovered(getItemId(item, $index))"
            [class.disabled]="isItemDisabled(item)"
            (click)="
              !isItemDisabled(item) &&
                toggleSubItem(getUniqueItemKey(item), item)
            "
            (mouseenter)="onItemHover(getItemId(item, $index))"
            (mouseleave)="onItemLeave()"
          >
            @if (item.icon) {
              <i [class]="item.icon" class="item-icon"></i>
            }
            <span class="item-label">{{ item.label }}</span>
            <span
              class="sub-arrow"
              [class.expanded]="isSubItemExpanded(getUniqueItemKey(item))"
            >
              <i
                class="fas"
                [ngClass]="
                  isSubItemExpanded(getUniqueItemKey(item))
                    ? 'fa-minus'
                    : 'fa-plus'
                "
              ></i>
            </span>
          </div>
          <ul
            class="sub-items"
            [class.expanded]="isSubItemExpanded(getUniqueItemKey(item))"
          >
            @for (
              subItem of item.children;
              track subItem.label + "-" + $index
            ) {
              <li>
                @if (hasChildren(subItem)) {
                  <div
                    class="sub-category-item"
                    [class.item-hovered]="
                      isItemHovered(subItem.label + '-sub-' + $index)
                    "
                    [class.disabled]="isItemDisabled(subItem)"
                    (click)="
                      !isItemDisabled(subItem) &&
                        toggleSubItem(
                          getUniqueItemKey(subItem, getUniqueItemKey(item)),
                          subItem
                        )
                    "
                    (mouseenter)="onItemHover(subItem.label + '-sub-' + $index)"
                    (mouseleave)="onItemLeave()"
                  >
                    @if (subItem.icon) {
                      <i [class]="subItem.icon" class="item-icon"></i>
                    }
                    <span class="item-label">{{ subItem.label }}</span>
                    <span
                      class="sub-arrow"
                      [class.expanded]="
                        isSubItemExpanded(
                          getUniqueItemKey(subItem, getUniqueItemKey(item))
                        )
                      "
                    >
                      <i
                        class="fas"
                        [ngClass]="
                          isSubItemExpanded(
                            getUniqueItemKey(subItem, getUniqueItemKey(item))
                          )
                            ? 'fa-minus'
                            : 'fa-plus'
                        "
                      ></i>
                    </span>
                  </div>
                  <ul
                    class="sub-sub-items"
                    [class.expanded]="
                      isSubItemExpanded(
                        getUniqueItemKey(subItem, getUniqueItemKey(item))
                      )
                    "
                  >
                    @for (
                      subSubItem of subItem.children;
                      track subSubItem.label + "-" + $index
                    ) {
                      <li>
                        @if (subSubItem.route) {
                          <a
                            [routerLink]="subSubItem.route"
                            [class.item-hovered]="
                              isItemHovered(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            [class.disabled]="isItemDisabled(subSubItem)"
                            (click)="
                              onItemClick(subSubItem, 2, [
                                item.label,
                                subItem.label,
                              ])
                            "
                            (mouseenter)="
                              onItemHover(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            (mouseleave)="onItemLeave()"
                          >
                            @if (subSubItem.icon) {
                              <i
                                [class]="subSubItem.icon"
                                class="item-icon"
                              ></i>
                            }
                            {{ subSubItem.label }}
                          </a>
                        } @else {
                          <div
                            class="menu-item-base"
                            [class.item-hovered]="
                              isItemHovered(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            [class.disabled]="isItemDisabled(subSubItem)"
                            (click)="
                              !isItemDisabled(subSubItem) &&
                                onItemClick(subSubItem, 2, [
                                  item.label,
                                  subItem.label,
                                ])
                            "
                            (mouseenter)="
                              onItemHover(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            (mouseleave)="onItemLeave()"
                          >
                            @if (subSubItem.icon) {
                              <i
                                [class]="subSubItem.icon"
                                class="item-icon"
                              ></i>
                            }
                            {{ subSubItem.label }}
                          </div>
                        }
                      </li>
                    }
                  </ul>
                } @else {
                  @if (subItem.route) {
                    <a
                      [routerLink]="subItem.route"
                      [class.item-hovered]="
                        isItemHovered(subItem.label + '-sub-' + $index)
                      "
                      [class.disabled]="isItemDisabled(subItem)"
                      (click)="onItemClick(subItem, 1, [item.label])"
                      (mouseenter)="
                        onItemHover(subItem.label + '-sub-' + $index)
                      "
                      (mouseleave)="onItemLeave()"
                    >
                      @if (subItem.icon) {
                        <i [class]="subItem.icon" class="item-icon"></i>
                      }
                      {{ subItem.label }}
                    </a>
                  } @else {
                    <div
                      class="menu-item-base"
                      [class.item-hovered]="
                        isItemHovered(subItem.label + '-sub-' + $index)
                      "
                      [class.disabled]="isItemDisabled(subItem)"
                      (click)="
                        !isItemDisabled(subItem) &&
                          onItemClick(subItem, 1, [item.label])
                      "
                      (mouseenter)="
                        onItemHover(subItem.label + '-sub-' + $index)
                      "
                      (mouseleave)="onItemLeave()"
                    >
                      @if (subItem.icon) {
                        <i [class]="subItem.icon" class="item-icon"></i>
                      }
                      {{ subItem.label }}
                    </div>
                  }
                }
              </li>
            }
          </ul>
        } @else {
          @if (item.route) {
            <a
              [routerLink]="item.route"
              [class.item-hovered]="isItemHovered(getItemId(item, $index))"
              [class.disabled]="isItemDisabled(item)"
              (click)="onItemClick(item, 0)"
              (mouseenter)="onItemHover(getItemId(item, $index))"
              (mouseleave)="onItemLeave()"
            >
              @if (item.icon) {
                <i [class]="item.icon" class="item-icon"></i>
              }
              {{ item.label }}
            </a>
          } @else {
            <div
              class="menu-item-base"
              [class.item-hovered]="isItemHovered(getItemId(item, $index))"
              [class.disabled]="isItemDisabled(item)"
              (click)="!isItemDisabled(item) && onItemClick(item, 0)"
              (mouseenter)="onItemHover(getItemId(item, $index))"
              (mouseleave)="onItemLeave()"
            >
              @if (item.icon) {
                <i [class]="item.icon" class="item-icon"></i>
              }
              {{ item.label }}
            </div>
          }
        }
      </li>
    }
  </ul>
</div>
