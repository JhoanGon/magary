<div
  class="panel-menu"
  [ngClass]="['shadow-' + shadow()]"
  [class.open]="isOpen()"
  [class.collapsed]="collapsed()"
  [ngStyle]="panelStyles()"
>
  <div
    class="panel-header"
    [class.header-hovered]="hoveredHeader()"
    (click)="toggle()"
    (mouseenter)="onHeaderHover(true)"
    (mouseleave)="onHeaderHover(false)"
  >
    @if (icon()) {
      <span class="header-icon {{ iconClass() || '' }}">
        <lucide-icon [name]="icon()"></lucide-icon>
      </span>
    }
    <span class="header-title">{{ title() }}</span>
    <span class="arrow" [class.open]="isOpen()">
      <lucide-icon name="chevron-down"></lucide-icon>
    </span>
  </div>
  <ul class="panel-items" [class.expanded]="isOpen()">
    @for (item of items(); track getItemId(item, $index)) {
      <li class="menu-item" [ngClass]="item.styleClass">
        @if (hasChildren(item)) {
          <div
            class="category-item"
            [class.item-hovered]="isItemHovered(getItemId(item, $index))"
            [class.disabled]="isItemDisabled(item)"
            (click)="
              !isItemDisabled(item) &&
                toggleSubItem(getUniqueItemKey(item), item)
            "
            (mouseenter)="onItemHover(getItemId(item, $index))"
            (mouseleave)="onItemLeave()"
          >
            @if (item.icon) {
              <span class="item-icon {{ item.iconClass || '' }}">
                <lucide-icon
                  [name]="item.icon"
                  [size]="item.iconSize || 15"
                ></lucide-icon>
              </span>
            }
            <span class="item-label">{{ item.label }}</span>
            @if (item.badgeSeverity) {
              <span
                class="menu-badge"
                [class]="'badge-' + (item.badgeSeverity || 'info')"
                >{{ item.badgeSeverity }}</span
              >
            }
            <span
              class="sub-arrow"
              [class.expanded]="isSubItemExpanded(getUniqueItemKey(item))"
            >
              <lucide-icon
                [name]="
                  isSubItemExpanded(getUniqueItemKey(item)) ? 'minus' : 'plus'
                "
              ></lucide-icon>
            </span>
          </div>
          <ul
            class="sub-items"
            [class.expanded]="isSubItemExpanded(getUniqueItemKey(item))"
          >
            @for (
              subItem of item.children;
              track subItem.label + "-" + $index
            ) {
              <li [ngClass]="subItem.styleClass">
                @if (hasChildren(subItem)) {
                  <div
                    class="sub-category-item"
                    [class.item-hovered]="
                      isItemHovered(subItem.label + '-sub-' + $index)
                    "
                    [class.disabled]="isItemDisabled(subItem)"
                    (click)="
                      !isItemDisabled(subItem) &&
                        toggleSubItem(
                          getUniqueItemKey(subItem, getUniqueItemKey(item)),
                          subItem
                        )
                    "
                    (mouseenter)="onItemHover(subItem.label + '-sub-' + $index)"
                    (mouseleave)="onItemLeave()"
                  >
                    @if (subItem.icon) {
                      <span class="item-icon {{ subItem.iconClass || '' }}">
                        <lucide-icon
                          [name]="subItem.icon"
                          [size]="subItem.iconSize || 15"
                        ></lucide-icon>
                      </span>
                    }
                    <span class="item-label">{{ subItem.label }}</span>
                    <span
                      class="sub-arrow"
                      [class.expanded]="
                        isSubItemExpanded(
                          getUniqueItemKey(subItem, getUniqueItemKey(item))
                        )
                      "
                    >
                      <lucide-icon
                        [name]="
                          isSubItemExpanded(
                            getUniqueItemKey(subItem, getUniqueItemKey(item))
                          )
                            ? 'minus'
                            : 'plus'
                        "
                      ></lucide-icon>
                    </span>
                  </div>
                  <ul
                    class="sub-sub-items"
                    [class.expanded]="
                      isSubItemExpanded(
                        getUniqueItemKey(subItem, getUniqueItemKey(item))
                      )
                    "
                  >
                    @for (
                      subSubItem of subItem.children;
                      track subSubItem.label + "-" + $index
                    ) {
                      <li [ngClass]="subSubItem.styleClass">
                        @if (subSubItem.route) {
                          <a
                            [routerLink]="subSubItem.route"
                            [class.item-hovered]="
                              isItemHovered(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            [class.disabled]="isItemDisabled(subSubItem)"
                            (click)="
                              onItemClick(subSubItem, 2, [
                                item.label,
                                subItem.label,
                              ])
                            "
                            (mouseenter)="
                              onItemHover(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            (mouseleave)="onItemLeave()"
                          >
                            @if (subSubItem.icon) {
                              <span
                                class="item-icon {{
                                  subSubItem.iconClass || ''
                                }}"
                              >
                                <lucide-icon
                                  [name]="subSubItem.icon"
                                  [size]="subSubItem.iconSize || 15"
                                ></lucide-icon>
                              </span>
                            }
                            <span class="item-label">{{
                              subSubItem.label
                            }}</span>
                          </a>
                        } @else {
                          <div
                            class="menu-item-base"
                            [class.item-hovered]="
                              isItemHovered(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            [class.disabled]="isItemDisabled(subSubItem)"
                            (click)="
                              !isItemDisabled(subSubItem) &&
                                onItemClick(subSubItem, 2, [
                                  item.label,
                                  subItem.label,
                                ])
                            "
                            (mouseenter)="
                              onItemHover(
                                subSubItem.label + '-subsub-' + $index
                              )
                            "
                            (mouseleave)="onItemLeave()"
                          >
                            @if (subSubItem.icon) {
                              <span
                                class="item-icon {{
                                  subSubItem.iconClass || ''
                                }}"
                              >
                                <lucide-icon
                                  [name]="subSubItem.icon"
                                  [size]="subSubItem.iconSize || 15"
                                ></lucide-icon>
                              </span>
                            }
                            <span class="item-label">{{
                              subSubItem.label
                            }}</span>
                          </div>
                        }
                      </li>
                    }
                  </ul>
                } @else {
                  @if (subItem.route) {
                    <a
                      [routerLink]="subItem.route"
                      [class.item-hovered]="
                        isItemHovered(subItem.label + '-sub-' + $index)
                      "
                      [class.disabled]="isItemDisabled(subItem)"
                      (click)="onItemClick(subItem, 1, [item.label])"
                      (mouseenter)="
                        onItemHover(subItem.label + '-sub-' + $index)
                      "
                      (mouseleave)="onItemLeave()"
                    >
                      @if (subItem.icon) {
                        <span class="item-icon {{ subItem.iconClass || '' }}">
                          <lucide-icon
                            [name]="subItem.icon"
                            [size]="subItem.iconSize || 15"
                          ></lucide-icon>
                        </span>
                      }
                      <span class="item-label">{{ subItem.label }}</span>
                      @if (subItem.badgeSeverity) {
                        <span
                          class="menu-badge"
                          [class]="'badge-' + (subItem.badgeSeverity || 'info')"
                          >{{ subItem.badgeSeverity }}</span
                        >
                      }
                    </a>
                  } @else {
                    <div
                      class="menu-item-base"
                      [class.item-hovered]="
                        isItemHovered(subItem.label + '-sub-' + $index)
                      "
                      [class.disabled]="isItemDisabled(subItem)"
                      (click)="
                        !isItemDisabled(subItem) &&
                          onItemClick(subItem, 1, [item.label])
                      "
                      (mouseenter)="
                        onItemHover(subItem.label + '-sub-' + $index)
                      "
                      (mouseleave)="onItemLeave()"
                    >
                      @if (subItem.icon) {
                        <span class="item-icon {{ subItem.iconClass || '' }}">
                          <lucide-icon
                            [name]="subItem.icon"
                            [size]="subItem.iconSize || 15"
                          ></lucide-icon>
                        </span>
                      }
                      <span class="item-label">{{ subItem.label }}</span>
                    </div>
                  }
                }
              </li>
            }
          </ul>
        } @else {
          @if (item.route) {
            <a
              [routerLink]="item.route"
              [class.item-hovered]="isItemHovered(getItemId(item, $index))"
              [class.disabled]="isItemDisabled(item)"
              (click)="onItemClick(item, 0)"
              (mouseenter)="onItemHover(getItemId(item, $index))"
              (mouseleave)="onItemLeave()"
            >
              @if (item.icon) {
                <span class="item-icon {{ item.iconClass || '' }}">
                  <lucide-icon
                    [name]="item.icon"
                    [size]="item.iconSize || 15"
                  ></lucide-icon>
                </span>
              }
              <span class="item-label">{{ item.label }}</span>
              @if (item.badgeSeverity) {
                <span
                  class="menu-badge"
                  [class]="'badge-' + (item.badgeSeverity || 'info')"
                  >{{ item.badgeSeverity }}</span
                >
              }
            </a>
          } @else {
            <div
              class="menu-item-base"
              [class.item-hovered]="isItemHovered(getItemId(item, $index))"
              [class.disabled]="isItemDisabled(item)"
              (click)="!isItemDisabled(item) && onItemClick(item, 0)"
              (mouseenter)="onItemHover(getItemId(item, $index))"
              (mouseleave)="onItemLeave()"
            >
              @if (item.icon) {
                <span class="item-icon {{ item.iconClass || '' }}">
                  <lucide-icon
                    [name]="item.icon"
                    [size]="item.iconSize || 15"
                  ></lucide-icon>
                </span>
              }
              <span class="item-label">{{ item.label }}</span>
            </div>
          }
        }
      </li>
    }
  </ul>
</div>
