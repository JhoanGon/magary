<div class="magary-tree-container" cdkDropListGroup>
  <!-- Filter Section -->
  @if (filter()) {
    <div class="magary-tree-filter">
      <lucide-icon
        name="search"
        [size]="16"
        class="magary-tree-filter-icon"
      ></lucide-icon>
      <input
        type="text"
        class="magary-tree-filter-input"
        [placeholder]="filterPlaceholder()"
        (input)="onFilterInput($event)"
      />
    </div>
  }

  @if (filteredValue() && filteredValue().length) {
    <ul
      class="magary-tree-root-children"
      cdkDropList
      [cdkDropListDisabled]="!droppable()"
      [cdkDropListData]="filteredValue() || []"
      (cdkDropListDropped)="handleDrop($event, null)"
    >
      @for (node of filteredValue(); track node.key || node.label) {
        <magary-uitree-node
          [node]="node"
          [selectionMode]="selectionMode()"
          [selection]="selection()"
          [draggable]="draggable()"
          [droppable]="droppable()"
          (nodeSelect)="handleNodeSelect($event)"
          (nodeUnselect)="handleNodeUnselect($event)"
          (nodeExpand)="handleNodeExpand($event)"
          (nodeCollapse)="handleNodeCollapse($event)"
          (nodeDrop)="onNodeDrop.emit($event)"
        >
        </magary-uitree-node>
      }
    </ul>
  }

  @if (!filteredValue() || filteredValue().length === 0) {
    <div class="magary-tree-empty-message">No records found</div>
  }
</div>
