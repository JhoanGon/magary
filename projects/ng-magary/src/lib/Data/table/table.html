<div
  class="magary-table-container"
  [class.responsive-layout]="responsiveLayout()"
>
  <!-- Header / Toolbar -->
  @if (title() || globalFilterFields().length > 0) {
    <div class="magary-table-header">
      @if (title()) {
        <div class="table-title">
          {{ title() }}
        </div>
      }
      <div class="table-actions">
        @if (globalFilterFields().length > 0) {
          <div class="search-wrapper">
            <magary-input
              placeholder="Search..."
              prefixIcon="fa-solid fa-search"
              (valueChange)="onSearch($event)"
              width="250px"
              size="small"
            >
            </magary-input>
          </div>
        }
      </div>
    </div>
  }

  <!-- Table Wrapper -->
  <div class="table-scroll-wrapper">
    <table class="magary-table">
      <thead>
        <tr>
          @for (col of columns(); track col.field) {
            <th [style.width]="col.width">
              {{ col.header }}
            </th>
          }
        </tr>
      </thead>
      <tbody>
        <!-- Data Rows -->
        @for (row of paginatedData(); track row) {
          <tr class="table-row">
            @for (col of columns(); track col.field) {
              <td [attr.data-label]="col.header">
                <!-- Content Switch -->
                @switch (col.type) {
                  @case ("avatar") {
                    <magary-avatar
                      [image]="resolveFieldData(row, col.field)"
                      [label]="
                        !resolveFieldData(row, col.field)
                          ? getAvatarLabel(row)
                          : ''
                      "
                      shape="circle"
                      size="normal"
                    >
                    </magary-avatar>
                  }
                  @case ("badge") {
                    <span
                      class="magary-badge"
                      [ngClass]="
                        'status-' +
                        resolveFieldData(row, col.field)?.toLowerCase()
                      "
                    >
                      {{ resolveFieldData(row, col.field) }}
                    </span>
                  }
                  @case ("currency") {
                    {{ resolveFieldData(row, col.field) | currency }}
                  }
                  @case ("date") {
                    {{ resolveFieldData(row, col.field) | date }}
                  }
                  @default {
                    {{ resolveFieldData(row, col.field) }}
                  }
                }
              </td>
            }
          </tr>
        }

        <!-- Skeleton Rows -->
        @if (loading()) {
          @for (i of [1, 2, 3, 4, 5]; track i) {
            <tr class="table-row skeleton-row">
              @for (col of columns(); track col.field) {
                <td>
                  <magary-skeleton
                    width="100%"
                    height="1.5rem"
                  ></magary-skeleton>
                </td>
              }
            </tr>
          }
        }

        <!-- Empty State -->
        @if (paginatedData().length === 0 && !loading()) {
          <tr class="empty-row">
            <td [attr.colspan]="columns().length">
              <div class="empty-state">
                <i class="fa-solid fa-inbox"></i>
                <p>No records found</p>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginator -->
  @if (paginator() && totalPages() > 1) {
    <div class="magary-paginator">
      <div class="paginator-info">
        Showing {{ first() + 1 }} to {{ first() + paginatedData().length }} of
        {{ totalRecords() }} entries
      </div>
      <div class="paginator-pages">
        <button
          class="page-btn nav-btn"
          [disabled]="currentPage() === 1"
          (click)="changePage(currentPage() - 1)"
        >
          <i class="fa-solid fa-chevron-left"></i>
        </button>

        @for (page of pagesArray(); track page) {
          <button
            class="page-btn number-btn"
            [class.active]="page === currentPage()"
            (click)="changePage(page)"
          >
            {{ page }}
          </button>
        }

        <button
          class="page-btn nav-btn"
          [disabled]="currentPage() === totalPages()"
          (click)="changePage(currentPage() + 1)"
        >
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
    </div>
  }
</div>
