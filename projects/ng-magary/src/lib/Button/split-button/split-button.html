<div
  [class]="
    'magary-split-button ' + styleClass() + (disabled() ? ' disabled' : '')
  "
>
  <button
    type="button"
    class="default-button"
    [disabled]="disabled()"
    (click)="onDefaultClick($event)"
  >
    @if (icon()) {
      <lucide-icon
        [name]="icon()"
        [size]="iconSize()"
        class="button-icon"
      ></lucide-icon>
    }
    <span class="button-label">{{ label() }}</span>
  </button>

  <button
    type="button"
    class="dropdown-trigger"
    #dropdownTrigger
    [disabled]="disabled()"
    [class.active]="isOpen()"
    (click)="toggleDropdown($event)"
    (keydown)="onTriggerKeydown($event)"
    aria-haspopup="menu"
    [attr.aria-expanded]="isOpen()"
  >
    <lucide-icon name="chevron-down"></lucide-icon>
  </button>

  @if (isOpen()) {
    <div class="split-button-menu">
      <ul role="menu" [attr.aria-label]="label() + ' actions'">
        @for (item of model(); track item.label || $index) {
          <li role="none" [class.disabled]="item.disabled">
            <button
              #menuItemButton
              type="button"
              class="menu-item-button"
              role="menuitem"
              [disabled]="item.disabled === true"
              [attr.aria-disabled]="item.disabled === true"
              (click)="onItemClick($event, item)"
              (keydown)="onMenuItemKeydown($event, $index)"
            >
              @if (item.icon) {
                <lucide-icon
                  [name]="item.icon"
                  [size]="iconSize()"
                  class="menu-item-icon"
                ></lucide-icon>
              }
              <span class="menu-item-label">{{ item.label }}</span>
            </button>
          </li>
        }
      </ul>
    </div>
  }
</div>
