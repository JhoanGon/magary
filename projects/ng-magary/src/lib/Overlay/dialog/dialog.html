@if (visible()) {
  <div
    [class]="'magary-dialog-mask magary-dialog-' + position()"
    [class.magary-dialog-mask-scrollblocker]="modal()"
    [class.magary-dialog-mask-transparent]="!modal()"
    [class.magary-dialog-absolute]="appendTo() === 'local'"
    [class.magary-dialog-glass-effect]="glass()"
    [@maskAnimation]
    (click)="onMaskClick($event)"
  >
    <div
      #container
      class="magary-dialog"
      [ngClass]="styleClass()"
      [class.magary-dialog-maximized]="maximized()"
      [class.magary-dialog-dragging]="dragging()"
      [class.magary-dialog-glass]="glass()"
      [style.width]="width()"
      [style.height]="height()"
      [style.background-color]="backgroundColor()"
      [ngStyle]="style()"
      [@dialogAnimation]
      (@dialogAnimation.start)="handleDialogAnimationStart($event)"
      (@dialogAnimation.done)="handleDialogAnimationDone($event)"
      (keydown)="onDialogKeydown($event)"
      role="dialog"
      [attr.aria-modal]="modal() ? 'true' : null"
      [attr.aria-labelledby]="header() ? titleId : null"
      [attr.aria-label]="header() ? null : ariaLabel()"
      tabindex="-1"
    >
      <!-- Header -->
      @if (header()) {
        <div class="magary-dialog-header" (pointerdown)="initDrag($event)">
          <span class="magary-dialog-title" [id]="titleId">{{ header() }}</span>
          <div class="magary-dialog-header-icons">
            @if (maximizable()) {
              <button
                type="button"
                class="magary-dialog-header-icon"
                (pointerdown)="$event.stopPropagation()"
                (click)="maximize($event)"
                [attr.aria-label]="maximized() ? 'Restore' : 'Maximize'"
              >
                <lucide-icon
                  [name]="maximized() ? 'minimize-2' : 'maximize-2'"
                ></lucide-icon>
              </button>
            }
            <button
              type="button"
              class="magary-dialog-header-icon"
              (pointerdown)="$event.stopPropagation()"
              (click)="close($event)"
              aria-label="Close"
            >
              <lucide-icon name="x"></lucide-icon>
            </button>
          </div>
        </div>
      }

      <!-- Content -->
      <div #content class="magary-dialog-content" [ngStyle]="contentStyle()">
        <ng-content></ng-content>
      </div>

      <!-- Footer -->
      <div class="magary-dialog-footer">
        <ng-content select="[slot=footer]"></ng-content>
        <!-- Fallback for legacy p-footer support or just generic footer content -->
        <ng-content select="p-footer"></ng-content>
      </div>

      <!-- Resizer -->
      @if (resizable() && !maximized()) {
        <div
          class="magary-dialog-resizer"
          (pointerdown)="initResize($event)"
          (click)="$event.stopPropagation()"
        ></div>
      }
    </div>
  </div>
}
