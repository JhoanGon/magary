<div
  #trigger
  cdkOverlayOrigin
  #origin="cdkOverlayOrigin"
  class="magary-select-container"
  [class.disabled]="disabled()"
  [class.focused]="focused()"
  [class.filled]="hasValue()"
  (click)="toggleOverlay()"
>
  <div class="selected-value">
    @if (hasValue()) {
      <span>{{ selectedLabel() }}</span>
    } @else {
      <span class="placeholder">{{ placeholder() }}</span>
    }
  </div>

  <div class="icons-container">
    @if (showClear() && hasValue() && !disabled()) {
      <lucide-icon
        name="x"
        [size]="16"
        class="clear-icon"
        (click)="clear($event)"
      >
      </lucide-icon>
    }
    @if (loading()) {
      <lucide-icon name="loader" class="spin" [size]="18"></lucide-icon>
    } @else {
      <lucide-icon name="chevron-down" [size]="18"></lucide-icon>
    }
  </div>

  <!-- CDK Overlay Template -->
  <ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="origin"
    [cdkConnectedOverlayOpen]="isOpen()"
    [cdkConnectedOverlayHasBackdrop]="true"
    [cdkConnectedOverlayBackdropClass]="'cdk-overlay-transparent-backdrop'"
    [cdkConnectedOverlayMinWidth]="trigger.offsetWidth"
    [cdkConnectedOverlayOffsetY]="4"
    (backdropClick)="close()"
  >
    <div
      class="select-overlay fade-in"
      (click)="$event.stopPropagation()"
      tabindex="-1"
    >
      @if (filter()) {
        <div class="filter-container">
          <input
            type="text"
            class="filter-input"
            [value]="filterValue()"
            (input)="onFilterInput($event)"
            placeholder="Search..."
            autofocus
          />
          <lucide-icon
            name="search"
            [size]="14"
            class="filter-icon"
          ></lucide-icon>
        </div>
      }

      <ul class="select-list" role="listbox">
        @for (option of visibleOptions(); track option) {
          <li
            class="select-item"
            [class.selected]="isSelected(option)"
            role="option"
            [attr.aria-selected]="isSelected(option)"
            (click)="selectOption(option)"
          >
            {{ getLabel(option) }}
            @if (isSelected(option)) {
              <lucide-icon
                name="check"
                [size]="16"
                class="check-icon"
              ></lucide-icon>
            }
          </li>
        }
        @if (visibleOptions().length === 0) {
          <li class="empty-message">No results found</li>
        }
      </ul>
    </div>
  </ng-template>
</div>
