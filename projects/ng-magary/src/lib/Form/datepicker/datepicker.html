<div
  class="magary-datepicker"
  [class.disabled]="isDisabled()"
  (click)="onContainerClick($event)"
>
  <div class="input-group">
    <input
      type="text"
      [placeholder]="placeholder() || 'dd/mm/yyyy'"
      [value]="formattedValue()"
      [disabled]="isDisabled()"
      (focus)="open()"
      (input)="onInput($event)"
      class="datepicker-input"
    />
    <button
      type="button"
      class="datepicker-trigger"
      [disabled]="isDisabled()"
      (click)="toggle()"
      tabindex="-1"
    >
      <lucide-icon name="calendar" [size]="18"></lucide-icon>
    </button>
  </div>

  @if (isOpen()) {
    <div class="datepicker-panel fade-in">
      <div class="calendar-header">
        <button type="button" class="nav-btn" (click)="prev()">
          <lucide-icon name="chevron-left" [size]="16"></lucide-icon>
        </button>
        <button type="button" class="view-switch-btn" (click)="switchView()">
          @if (currentView() === "day") {
            {{ currentMonthName() }} {{ currentYear() }}
          } @else if (currentView() === "month") {
            {{ currentYear() }}
          } @else {
            {{ years()[0] }} - {{ years()[10] }}
          }
        </button>
        <button type="button" class="nav-btn" (click)="next()">
          <lucide-icon name="chevron-right" [size]="16"></lucide-icon>
        </button>
      </div>

      <!-- Day View -->
      @if (currentView() === "day") {
        <div class="calendar-grid">
          @for (day of weekDays; track day) {
            <div class="weekday">{{ day }}</div>
          }

          @for (day of calendarDays(); track $index) {
            <div
              class="day"
              [class.empty]="!day"
              [class.today]="isToday(day)"
              [class.selected]="isSelected(day)"
              [class.disabled]="isDisabledDate(day)"
              [class.range-start]="isRangeStart(day)"
              [class.range-end]="isRangeEnd(day)"
              [class.in-range]="isInRange(day)"
              (click)="selectDate(day)"
            >
              {{ day?.getDate() }}
            </div>
          }
        </div>
      }

      <!-- Month View -->
      @if (currentView() === "month") {
        <div class="month-grid">
          @for (month of monthNames; track month; let i = $index) {
            <div class="month-item" (click)="selectMonth(i)">
              {{ month.substring(0, 3) }}
            </div>
          }
        </div>
      }

      <!-- Year View -->
      @if (currentView() === "year") {
        <div class="year-grid">
          @for (year of years(); track year) {
            <div
              class="year-item"
              [class.current]="year === currentYear()"
              (click)="selectYear(year)"
            >
              {{ year }}
            </div>
          }
        </div>
      }
    </div>
  }
</div>
